---
import Base from "../layouts/base.astro";
import App from '../components/client-pages/Cart'
import { getActiveCustomer, getActiveOrder } from "../api/server";

const cookie = Astro.request.headers.get('cookie');
console.log('cookie', cookie);
let order, customerName;
if (cookie) {
	order = (await getActiveOrder(cookie)).activeOrder;
	console.log('order', order)
	const activeCustomer = (await getActiveCustomer(cookie)).activeCustomer;
    console.log('acitve customer', activeCustomer); 
	if (activeCustomer) customerName = activeCustomer?.firstName + ' ' + activeCustomer?.lastName;
}
if (!cookie || !order) {
    return Astro.redirect('/');
}
---

<Base>
<App client:load order={order} customerName={customerName} />
</Base>