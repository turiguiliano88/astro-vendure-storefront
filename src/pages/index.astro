---
import Base from '../layouts/base.astro';
import Nav from '../components/Nav'
import { CardTitle, CardContent, Card } from '../components/ui/Card';
import ItemCard from '../components/ItemCard';
import { getProducts, getActiveCustomer, getActiveOrder } from '../api/server';

const data = await getProducts(10);
const products = data.products;

const cookie = Astro.request.headers.get('cookie');
console.log('cookie', cookie);
let totalQuantity, customerName;
if (cookie) {
	totalQuantity = (await getActiveOrder(cookie)).activeOrder?.totalQuantity;
	console.log('total quantity', totalQuantity)
	const activeCustomer = (await getActiveCustomer(cookie)).activeCustomer;
	if (activeCustomer) customerName = activeCustomer?.firstName + ' ' + activeCustomer?.lastName;
}

console.log('order', totalQuantity, 'customer', customerName)
---

<Base title="Home">
	<Nav client:load customerName={customerName} totalQuantity={totalQuantity} />
	<div class="max-w-7xl my-lg mx-auto">
		<Card>
		<CardTitle>Our offers</CardTitle>
		<CardContent>
			<div class="flex flex-wrap">
			{products.items?.map((item) => {
				return (
				<div class="w-1/2 md:w-1/3 xl:w-1/4 p-xxs md:p-xs">
					<ItemCard
					img_url={item.featuredAsset.preview}
					path={`product/${item.slug}`}
					name={item.name}
					price={item.variants[0].price}
					/>
				</div>
				);
			})}
			</div>
		</CardContent>
		</Card>
	</div>
</Base>